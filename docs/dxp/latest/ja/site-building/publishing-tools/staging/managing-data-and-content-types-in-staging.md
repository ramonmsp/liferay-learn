# ステージングでのデータとコンテンツタイプの管理

Liferay DXPのステージングツールは、初期構成と公開プロセスの両方で、利用可能なアプリケーションデータとコンテンツタイプを管理する方法を提供します。 アプリケーションとコンテンツのタイプの間には非常に多くの関係がある可能性があるため、カテゴリをステージングまたはステージング解除することを決定する前に、データベース内でそれらがどのように相互に参照されているかを必ず検討してください。

  - [データとコンテンツタイプのステージング](#staging-data-and-content-types)
  - [データとコンテンツタイプの公開](#publishing-data-and-content-types)

## データとコンテンツタイプのステージング

ステージング設定の一部として、ステージングするアプリケーションデータとコンテンツタイプを選択できます。 ステージングされた場合、選択されたデータとコンテンツは、含まれているすべてのエンティティとともにステージング環境によって管理され、本番環境で直接編集できない場合があります。

![ステージングするアプリケーションデータとコンテンツタイプを選択します。](./managing-data-and-content-types-in-staging/images/01.png) ステージングを行う際は、サイトで使用しているアプリケーションと、それらがステージングに適しているかどうかを検討する必要があります。

  - ステージングされていないデータは、サイトの本番環境にのみ存在します。 ステージングされたデータは両方の環境に存在します。
  - ブログ、掲示板、Wikiなどのコラボレーションアプリケーションは、公開するまで本番環境サイトに投稿が表示されないため、ステージングしないでください。
  - サイトに範囲指定されたコンテンツのみをステージングできます。
  - ページに範囲指定されたデータは、公開されたページでのみステージングできます。そのデータはページとともに公開されます。
  - アプリケーションを無効化したりサイトから削除したが、そのアプリケーションがステージング設定でまだ選択されている場合、そのアプリケーションは引き続き公開されており、アセットパブリッシャーなどの集約アプリに表示される場合があります。
  - ステージングされたサイトのアセットパブリッシャーは、ステージングされていないアプリのデータにアクセスできません。それらのデータは本番環境サイトにのみ存在するためです。 アセットパブリッシャーの構成に、ステージングされたアプリとステージングされていないアプリの両方のデータが表示されている場合、ステージングされたサイトと本番環境サイトの両方で同じようには表示されません。

**ステージングされたアプリケーションとステージングされていないアプリケーションのコンテンツオリジン**

| コンテンツの種類             | ステージ  | アンステージ | ステージングされたデータオリジン | データオリジン本番環境 |
| -------------------- | ----- | ------ | ---------------- | ----------- |
| コラボレーション             |       | ✔      |                  | ✔           |
| サイトスコープ              | ✔     |        | ✔                |             |
| ページスコープのアプリ          | ✔\* |        | ✔                |             |
| ステージング構成で選択されていないアプリ |       | ✔      |                  | ✔           |
| ステージング構成で選択されているアプリ  | ✔     |        | ✔                |             |

\* *ページが公開されたときにのみ公開されます*

```{important}
After configuration, users can't change whether or not an application data or content type is staged. This is because staging and unstaging this data and content could cause inconsistencies between Staging and Live environments. To change these settings, you must turn staging off and re-enable it with your new configuration.
```

## データとコンテンツタイプの公開

公開プロセス中に、ステージングから本番環境に公開されるアプリケーションデータとコンテンツタイプを構成することもできます。 *[本番環境に公開]* メニューの*[詳細設定]* タブから、各タイプとそれに関連するデータおよびコンテンツを表示できます。

![ステージングから本番環境に公開されるアプリケーションデータとコンテンツタイプを構成します。](./managing-data-and-content-types-in-staging/images/02.png)

ここでは、公開またはエクスポート中に一部のデータとコンテンツタイプを除外して、プロセスを高速化できます。

### バージョン履歴

Webコンテンツは頻繁に更新される傾向があるため、バージョン数が多くなり、公開時間が長くなる可能性があります。 *バージョン履歴*を公開しないようにすることができます。 これを無効にすると、各Webコンテンツ記事の最後に承認されたバージョンのみが本番環境に公開されます。 これにより、公開プロセスを大幅にスピードアップできます。

デフォルトでは、バージョン履歴が公開するように選択されているため、Webコンテンツの最終承認済みバージョンのみを公開するには、この設定を手動で無効にする必要があります。 これを行うには、*[コントロールパネル]* → *[設定]* → *[システム設定]* → *[Webコンテンツ]* → *[仮想インスタンススコープ]* → *[Webコンテンツ]* に移動し、*[Version History by Default Enabled]* チェックボックスを切り替えます。

### プレビューとサムネイル表示

プレビューとサムネイル表示は、ドキュメントに対して自動的に生成されます。 ただし、サイトに多数の画像またはドキュメントが含まれている場合は、この機能を無効にして、公開速度を上げ、使用するディスク容量を制限することをお勧めします。

ファイルのプレビューとサムネイルを公開するかどうかは、環境によって異なります。 それらの公開は手間のかかる操作であり、リモートステージングを使用している場合は、LARファイルもネットワーク経由で転送する必要があります。 本番環境サイトでプレビューを生成する場合は、CPUに負荷がかかるため、時間がかかる可能性があることを理解しておいてください。

### ボキャブラリ

サイト内で作業する場合、現在のサイトとグローバルサイトの両方からボキャブラリを選択できます。 これはコンテンツの作成時に問題を引き起こすことはありませんが、公開時に問題を引き起こす可能性があります。

グローバルボキャブラリとローカルボキャブラリの両方を使用する環境では、グローバルボキャブラリをグローバルサイトのステージングを通じて本番環境サイトに公開する必要があることに注意してください。 ボキャブラリの混乱を避ける1つの方法は、すべてのボキャブラリをローカルまたはグローバルに保つことです。 両方を使用しなければならない場合は、依存関係がローカルであるかグローバルであるかにかかわらず、依存関係（カテゴリやボキャブラリなど）を確実に公開してから、それらに依存しているサイトを公開することで、問題を解決できます。

```{note}
Assets like tags, categories, structures, templates, widget templates, document types, and dynamic data lists can also be shared by a parent to its child Sites. In this case, ensure that the parent's dependencies are published before the Site in question.
```

### 削除

ステージングフレームワークは、サイト内の削除項目（破棄されたエンティティを含む）を収集します。 これらの削除項目は、本番環境サイトをクリーンアップするために公開できます。 後で処理する予定がある場合、または本番環境にデータが残っていても問題がない場合は、これをオフにして、処理中の実行時間を節約することもできます。

## 追加情報

  - [Staging Overview](../staging.md)
  - [公開プロセスを理解する](./understanding-the-publishing-process.md)
  - [Staging UI Reference](./staging-ui-reference.md)
