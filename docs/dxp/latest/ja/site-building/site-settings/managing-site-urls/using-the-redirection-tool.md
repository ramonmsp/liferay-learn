# リダイレクションツールの使用

URLの整合性を維持することは、どのサイトにとっても重要です。 Liferay DXPの*リダイレクト*ツールは、HTTPリダイレクトを管理し、404エラーを追跡するための便利で統合された方法を提供します。 このツールを使えば、簡単にリンク切れを回避・修正することができ、ユーザーエクスペリエンスとSEOの両方を向上させることができます。

このツールにアクセスするには、プロダクトメニューを開き、*[設定]* →*[Redirection]* に移動します。

![プロダクトメニューの[Redirection]ページに移動します。](./using-the-redirection-tool/images/01.png)

ここでは、リダイレクトツールの機能性が*[リダイレクト]* と*[404 URL]* の2つのタブに編成されています。

  - [リダイレクト](#redirects)
  - [404 URL](#404-urls)

## リダイレクト

*[リダイレクト]* タブでは、*恒常的な*URLリダイレクト（301）と*一時的な* URLリダイレクト（302）の両方を作成および管理できます。

![[リダイレクト]タブから、永続的および一時的なURLリダイレクトを作成および管理できます。](./using-the-redirection-tool/images/02.png)

どちらもユーザーを指定された宛先に自動的に誘導しますが、それぞれがサイトに固有の影響を及ぼします。 リダイレクトを作成する前に、状況に最適なタイプを検討してください。

  - **永久**：301コードを使用して、サイトにアクセスする検索エンジンやその他のツールに、要求されたリソースが永久的に再配置されたことを通知します。 検索エンジンは古いURLを検索結果の新しい宛先に置き換え、ブラウザは新しい宛先を不確定な時間だけキャッシュします。 301コードは、行先URLを無期限に使用する場合にのみ使用してください。 これにより、SEOが向上し、意図しないキャッシュを回避できます。
  - **一時的**：302コードを使用して、サイトにアクセスする検索エンジンやその他のツールに、要求されたリソースが一時的に移動されたことを通知します。 302コードは、サイトのランキングに影響を与えることなく、問題を修正しながらA/Bテストを実行したりトラフィックをリダイレクトしたりする場合に役立ちます。 DXPはデフォルトで302コードを使用します。

SEOの各リダイレクトタイプの影響の詳細については、[Search Engine Optimization](../../optimizing_sites.html#search-engine-optimization)を参照してください。 また、テスト時に302コードを使用する方法については、[A/B Testing](../../optimizing-sites/ab_testing.html)を参照してください。

### リダイレクトの作成

以下の手順に従って、リダイレクトを作成します。

1.  *追加*ボタン（![Add button](../../../images/icon-add.png)）をクリックします。 *[新規リダイレクト]* 画面が表示されます。

    ![追加ボタンをクリックして、新しいリダイレクトを作成します。](./using-the-redirection-tool/images/03.png)

2.  *[ソースURL]* フィールドに一意の相対URLを入力して、リダイレクトをトリガーするリンクを指定します。 入力した値は、その上に表示されるベースURLに追加されます。

    ![[ソースURL]フィールドに一意の相対URLを入力します。](./using-the-redirection-tool/images/04.png)

3.  *[行先URL]* フィールドに絶対URLを入力して、目的の宛先へのリンクを指定します。

    この宛先は内部または外部にすることができますが、常に絶対URLとして入力する必要があります。 *ショートカット*アイコン（![Shortcut icon](../../../images/icon-shortcut.png)）をクリックして、入力したURLを確認することもできます。

    ![[行先URL]フィールドに絶対URLを入力します。](./using-the-redirection-tool/images/05.png)

4.  *[タイプ]* ドロップダウンメニューを使用して、リダイレクトが永続的（301）か一時的（302）かを判別します。

    ![リダイレクトが永続的か一時的かを判断します。](./using-the-redirection-tool/images/06.png)

5.  オプションで、リダイレクトの自動*有効期限*を設定できます。 有効期限が切れないように、このフィールドは空のままにします。

    ![リダイレクトの有効期限が切れるかどうかを確認します。](./using-the-redirection-tool/images/07.png)

6.  終了したら、*[Create]* をクリックしてリダイレクトを保存します。

保存されると、Liferay DXPが設定を検証します。 他のリダイレクトが指定されたソースURLを指している場合、DXPはその旨を通知し、リダイレクトチェーンを回避するために既存のリダイレクトを更新するかどうかを尋ねます。

![DXPは、リダイレクトチェーンの作成を回避するのに役立ちます。](./using-the-redirection-tool/images/08.png)

同じソースURLに対して複数のリダイレクトを作成しようとした場合、または指定したソースURLと宛先URLによってリダイレクトループが発生した場合も、DXPはエラーを返します。

### リダイレクトの編集と削除

URLリダイレクトを正常に追加したら、*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックして*[Edit]* または*[Delete]* を選択することで、いつでもリダイレクトを編集または削除できます。

![リダイレクトはいつでも編集または削除できます。](./using-the-redirection-tool/images/09.png)

```{note}
Changes made to a redirect may not immediately display in browsers that have cached the old redirect configuration.
```

## 404 URL

*[404 URL]* タブでは、404エラーにつながるサイトリクエストを表示および管理できます。 DXPでは各エラーがカタログ化されているため、エラーの原因を評価し、問題を迅速に解決できます。

![404 URLを表示および管理できます。](./using-the-redirection-tool/images/10.png)

ここでは、カタログ化された404 URLを検索、フィルタリング、順序付けしたり、必要に応じてリダイレクトを作成したりできます。 これらのURLは、コントロールパネルのリダイレクト設定に従ってデータベースに保持されます。ここで、カタログ化される404の数と期間の両方を設定できます。

### 404 URLの表示

カタログ化されたリクエストは、*タイプ*と*日付*の両方でフィルタリングできます。 タイプでフィルタリングするときは、表示する404 URLを*[有効]*、*[Ignored]*、または*[All]* から選択できます。 日付によるフィルタリングでは、すべてのURLを表示するか、あるいは過去1日、1週間、1ヶ月以内にリクエストされたURLのみを表示するかを決めることができます。 また、カタログ化されたリクエストを、*更新日*や*リクエスト数*で順序付けすることもできます。

デフォルトでは、このページにはすべての有効なURLが番号順に表示されます。

![カタログ化された404 URLをフィルタリングして順序付けできます。](./using-the-redirection-tool/images/11.png)

### 404 URLを無視する/無視しない

URLがアクティブか無視されているかを判断するには、*アクション*ボタン (![Actions button](../../../images/icon-actions.png)) をクリックして、*[無視する]*/*[無視しない]* を選択します。 無視すると、URLはデフォルトの*[有効]* ビューで非表示になりますが、ステータスはいつでも変更できます。

![URLが有効か無視されているかを判別できます。](./using-the-redirection-tool/images/12.png)

### 404 URLのリダイレクトの作成

404 URLの*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックし、*[リダイレクトを作成]* を選択することで、簡単にリダイレクトを作成することができます。 これにより、*[新規リダイレクト]* 画面が表示され、ソースURLに選択した404が事前に入力されます。

フォームへの入力を完了し、*[Create]* をクリックして新しいリダイレクトを保存します。

![404 URLのリダイレクトを作成します。](./using-the-redirection-tool/images/13.png)

### 404設定の構成

リクエスト間で404 URLを保持する期間と、データベースに保存される404 URLの最大数を決定できます。

これを行うには、コントロールパネルを開き、[仮想インスタンススコープ]の下の*[システム設定]*（または*[Instance Settings]*）→ *[Pages]* → *[Redirection]* に移動します。

デフォルトでは、*[見つからなかったエントリーのリダイレクト有効期間]* は30日に設定されており、*[404 URLの最大数]* は1000エントリに設定されています。

![保持する404 URLの期間と数を決定します](./using-the-redirection-tool/images/14.png)
