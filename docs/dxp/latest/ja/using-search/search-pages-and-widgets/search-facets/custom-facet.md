# カスタムファセット設定

カスタムファセットは、すぐに使用できる検索ファセットの中でもユニークなものです。 結果を単一の静的フィールド（更新日やアセットタイプなど）でグループ化するのではなく、カスタムファセットを使用して結果をグループ化するフィールドを選択します。 さらにカスタマイズして、まったく新しいファセットを作成できます。

## カスタムファセットの設定

1.  ページ上部の*追加*アイコン（![Add icon](../../../images/icon-add-app.png)）をクリックします。

2.  カスタムファセットを見つけて、左側のファセットのコレクションにドラッグします。 カスタムファセットは、ウィジェットの[検索機能]セクションにあります。

    ![検索ウィジェットの下でカスタムファセットを見つけます。](custom-facet/images/01.png)

3.  ファセットの*オプション*アイコン（![Options icon](../../../images/icon-app-options.png)）をクリックし、*[設定]* をクリックします。

    ![[設定]オプションをクリックします。](custom-facet/images/02.png)

    カスタムファセットには、以下で説明するいくつかの設定オプションがあります。

4.  オプションの設定が終了したら、*[保存]* ボタンをクリックします。

**表示設定：***[Default]*、*[コンパクトレイアウト]*、*[ラベルレイアウト]* から選択します。 デフォルトのレイアウトでは、各用語の横にチェックボックスが表示されますが、コンパクトレイアウトでは表示されません。 ラベルレイアウトでは、用語ごとにクリック可能な小さなラベルが表示されます。

詳細設定には、追加のオプションが含まれています。

**集約フィールド：** 結果を集計するインデックス付きフィールドの名前を入力します。 これは、分析されていないキーワードフィールドでなければなりません。 詳細については、以下を参照してください。

**カスタム見出し：** このファセットに表示する見出しを入力します。 設定されていない場合、集約されたフィールド名が表示されます。

**カスタムパラメータ名：**選択した値のURLパラメーター名を指定します。 設定されていない場合、集約されたフィールド名が使用されます。

**最大ターム数：**ファセットに一致する用語がいくつ見つかったかに関係なく、表示するファセット用語の最大数を設定します。

**頻度の閾値：**用語がファセット用語のリストに表示されるために必要な最小頻度を設定します。 たとえば、ファセットの頻度の閾値が3に設定されている場合、一致する結果が2つの用語は用語結果リストに表示されません。

**表示頻度：**用語頻度を表示するかどうかを選択します。

**統合検索キー：** このウィジェットが参加している代替検索のキーを入力します。 設定されていない場合、このウィジェットはデフォルトの検索に参加します。 この値は通常、アプリケーション定義のインデックスの名前です。

## インデックス付きフィールドの検索

カスタムファセットを使用するには、指定する分析されていないキーワードフィールドを知っている必要があります。

使用可能なフィールドのリスト全体を参照するには、*[コントロールパネル]* → *[設定]* → *[検索機能]* からフィールドマッピングを調べます。 または、検索エンジンのAPIを使用します。

Elasticsearchの場合、ターミナルからcURLを使ってフィールドマッピングにアクセスし、[[Get Mapping API]](https://www.elastic.co/guide/en/elasticsearch/reference/7.x/indices-get-mapping.html)を呼び出します。

``` bash
curl -X GET "localhost:9200/_mapping/LiferayDocumentType"?pretty
```

Solrは[ListFields API](https://lucene.apache.org/solr/guide/6_6/schema-api.html#SchemaAPI-ListFields)を使用します。

``` bash
curl http://localhost:8983/solr/liferay/schema/
```

以下は、Elasticsearchの例からの出力の一部です。

``` json
"ddmStructureKey": {
  "store": true,
  "type": "keyword"
},
"ddmTemplateKey": {
  "store": true,
  "type": "keyword"
},
"defaultLanguageId": {
  "store": true,
  "type": "keyword"
},
"description": {
  "store": true,
  "term_vector": "with_positions_offsets",
  "type": "text"
},
"discussion": {
  "store": true,
  "type": "keyword"
},
```

カスタムフィールドを使用して、分析されていない共有キーワードフィールド値によってファセット用語を集計します。
