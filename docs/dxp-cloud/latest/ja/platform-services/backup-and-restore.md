# バックアップと復元

実稼働アプリケーションのデータが安全であることが重要です。 DXP Cloudはデータをバックアップおよび復元できます。 すべてのバックアップは、データベース、環境ボリューム、およびDocuments and Mediaフォルダーのダンプを保存します。 ここでは、DXP Cloud Webコンソールを介して手動でバックアップを作成および復元する方法を学習します。

  - [手動バックアップの作成](#creating-a-manual-backup)
  - [バックアップから復元](#restoring-from-a-backup)
  - [データの復元を使用したカスタムSQLスクリプトの適用](#applying-custom-sql-scripts-with-a-data-restore)

自動バックアップを含むバックアップサービスの設定手順については、 [バックアップサービス](./backup-service.md)参照してください。

```{note}
バックアップ]タブは、*プロダクション*環境でのみ使用できます。 このタブから、ユーザーがアクセスできる任意の環境にバックアップを復元することができます。
```

## 手動バックアップの作成

手動バックアップを作成するには、次の手順に従います。

1.  本番環境のページで、左側のメニューの[ *バックアップ* ]タブを選択します。

2.  *[Backup Now]* をクリックします。

    ![図1：DXP Cloudでバックアップを作成できます。](./backup-and-restore/images/01.png)

## バックアップから復元

[Backups] タブには、環境内の各バックアップを示すテーブルが含まれています。 テーブルには、各バックアップの名前、サイズ、作成日時が表示されます。 バックアップから復元するには、表でそのバックアップの[ *アクション* ]ボタン（![Actions](./backup-and-restore/images/02.png)）をクリックし、[ *復元*]を選択します。

![図2：DXP Cloudのバックアップから復元できます。](./backup-and-restore/images/03.png)

## データの復元を使用したカスタムSQLスクリプトの適用

カスタムSQLスクリプトを使用して、通常のデータリストアでデータベースに追加の更新を実行することもできます。 このアプローチは、個別に維持されるデータベースのバックアップにスクリプトを適用できるため、機密データのサニタイズに最適です。

```{note}
この機能を使用するには、バックアップサービスのバージョンが3.0.7以上である必要があります（少なくともDockerイメージを使用しています: liferaycloud/backup:3.0.7）。
```

### SQLスクリプトの準備

SQLスクリプトでは、次の形式がサポートされています。

  - 個々のスクリプトの場合、 `.sql`
  - 圧縮ファイル内の複数のスクリプトの`.zip`, `.tgz`, または `.gz`

スクリプトは、実行時に英数字順に実行されることに注意してください。 SQLスクリプトは、実行するデータベースも正確に参照する必要があります（たとえば、USEポータルが `場合、` ポータルまたは `ポータルの場合）。 User_`）。

スクリプトを `lcp/backup/script /`内の適切な環境のサブフォルダーに配置します。

    lcp
    └── backup
        ├── LCP.json
        └── script
            ├── common
            ├── dev
            ├── local
            ├── prd
            └── uat

### データの復元の実行

あなたは、あなたのSQLスクリプト（複数可）を用意したら [デプロイあなたのサービス](../build-and-deploy/overview-of-the-dxp-cloud-deployment-workflow.md) これらのオンラインバックアップサービスに含まれるように。

次に、本番環境のページに移動し、左側のメニューから[ *バックアップ* ]をクリックします。

![本番環境の[バックアップ]ページ。](./backup-and-restore/images/04.png)

[アクション]メニューをクリックし、[ *復元*]をクリックして、表示されているバックアップから復元します。

復元先の環境を選択し、[ *バックアップを復元して現在のバージョンにする*]をクリックします。 データベースが復元されると、バックアップサービスの `スクリプト` フォルダーのSQLスクリプトが実行されます。

``` bash
Jun 20 14:46:41.795 build-39 [backup-57488f8b8-rjq4f] Running Script: SanitizeOrg.sql
Jun 20 14:46:41.970 build-39 [backup-57488f8b8-rjq4f] Running Script: SanitizeUsers.sql
```
