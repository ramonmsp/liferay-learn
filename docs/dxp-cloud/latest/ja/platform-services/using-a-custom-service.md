# カスタムサービスの使用

DXP Cloudを使用すると、追加設定なしで提供される標準のサービスセットだけを実行することはできません。 また、カスタムサービスを作成して展開し、DXP Cloudインフラストラクチャ内で新しいプロセスを実行することもできます。 DXP Cloud環境でカスタムサービスの使用を有効にしたいお客様は、この機能を有効にして環境が適切にプロビジョニングされていることを確認するために、まず営業担当者に連絡する必要があります。

```{note}
カスタムサービスを追加するためには、十分なハードウェアリソースが用意されている必要があります。 プロビジョニングプロセス中にカスタムサービスに追加のリソースを割り当てることができます。
```

DXP Cloudは、サービスの基盤としてDockerイメージを使用しています。 あなたがローカルで、これらのサービスを実行したい場合は、 [ドッカーインストール](https://docs.docker.com/get-docker/) ローカルシステムに。

## カスタムサービスの追加

次の手順を使用して、DXP Cloudのビルドに独自のカスタムサービスを追加します。

1.  カスタムサービスをDockerイメージとして作成または検索します。 プロジェクトのワークスペースに直接追加したDockerfileを使用するか、 [Docker Hub](https://hub.docker.com/)などのパブリックリポジトリのイメージを使用できます。

2.  サービス用の新しいディレクトリを他のサービスディレクトリ（たとえば `liferay` および `データベース`）と一緒に追加し、その中に `LCP.json` ファイルを含めます。
   
        ├── backup
        ├── ci
        ├── database
        ├── liferay
        ├── search
        ├── webserver
        └── myCustomService
            └── LCP.json

    このファイルに設定を追加する方法の詳細は、[LCP.jsonによる設定 ](../reference/configuration-via-lcp-json.md) を参照してください。

    ```{warning}
    新しいカスタムサービスでビルドをトリガーしても、新しいサービスのために十分なリソースがプロビジョニングされていない場合、他のサービスに割り当てられたリソースに干渉する可能性があります。

    LCP.jsonファイルで新しいサービスのメモリとCPUの割り当てを直接設定して、正しい量のハードウェアリソースを取得できるようにします。
    ```

3.  カスタムサービスを適用する環境を`LCP.json`内で指定します。 これは、新しいサービス用にプロビジョニングしたリソースの数によって異なります。

    たとえば、ビルドを `prd` 環境にのみ適用するには、 `LCP.json`次のプロパティを追加します。

    ``` json
    {
      "environments": {
          "prd": {
            "deploy": true
          }
      }
    }
    ```

    そのようなプロパティが指定されていない場合、デフォルトでは、サービスはすべての環境用のカスタムサービスを構築しようとします。

4.  4  Dockerイメージを新しいサービスに適用します。 Dockerイメージの追加に使用する方法は、パブリックリポジトリにアップロードされたイメージを使用しているか、ローカルのDockerfileを使用しているかによって異なります。

      - **公開リポジトリからのDockerイメージを使用している場合。** イメージの名前を `LCP.json`内の `イメージ` プロパティに追加します。
        
            "image": "mydockerimages/myservice:1.0.0"

      - **ローカルのDockerfileを使用している場合。** カスタムサービスのディレクトリにDockerfileを追加します。 サービスがビルドされると、DockerfileからのDockerイメージがサービスのイメージとして自動的に選択されます。

        ```{note}
        Dockerfileは自動的にサービスのイメージとして使用されます。 その結果、LCP.jsonの "image "プロパティは無視されます。
        ```

5.  これらの変更をバージョン管理のブランチにコミットします。

    ``` bash
    git add my-custom-service/
    git commit -m "Add custom service"
    ```

6.  ブランチをアップして、DXP Cloudで新規ビルドを開始してデプロイします。 ビルドのデプロイについては、 [DXP Cloudデプロイメントの概要](./overview-of-the-dxp-cloud-deployment-workflow#deploy) デプロイメントに関する情報を参照してください。

変更を加えたCIで新しいビルドをトリガーしたら、DXP Cloudコンソールの *ビルド* 画面に移動して、ビルドを確認できます。 *サービス* 列にリストされているサービスには、他のサービスとの新しいサービスが含まれています。

このビルドをいずれかの環境にデプロイする場合（[アクション]メニューで[ *ビルドを* にデプロイ]をクリックして）、その環境の *サービス* ページに移動して、そこにリストされているカスタムサービスを確認することもできます。

![新規 "カスタムサービス" 他のサービスと一緒にデプロイします。](./using-a-custom-service/images/01.png)

## 追加情報

  - [DXP Cloud導入ワークフローの概要](../build-and-deploy/overview-of-the-dxp-cloud-deployment-workflow)
