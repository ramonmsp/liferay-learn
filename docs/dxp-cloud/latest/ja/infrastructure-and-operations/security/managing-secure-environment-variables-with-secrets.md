# シークレットによる安全な環境変数の管理

シークレットを使用すると、DXP Cloud内の任意の環境の変数を安全に保存できます。 DXP Cloudプロジェクトを表示する権限を持つすべてのユーザーは [環境変数](../../reference/defining-environment-variables.md)表示できますが、シークレットは、その役割にそれらを表示する権限が付与されている場合にのみ表示できます。

## 秘密とは？

シークレットは、その値を保護するための追加のセキュリティ対策を備えた環境変数です。 機密情報やプライベート情報(クレデンシャルなど)を定義する環境変数はすべて秘密として保存されるべきです。 シークレットは、環境内の任意の数のサービスの安全な変数として定義できます。

シークレットを表示する権限を持つユーザーは、任意のサービスの[ *環境変数* ]タブでシークレットを表示できます。 それらは他の環境変数と同じページに表示され、独自のセクションにあります。

![「環境変数」ページには、通常の環境変数とシークレットの両方がリストされています。](./managing-secure-environment-variables-with-secrets/images/01.png)

デフォルトでは、シークレットは *Admin* ロールを持つユーザーのみが表示できます。 ただし、シークレットは、他のロールを持つユーザーも表示できるように設定できます。

シークレットは暗号化して保存され、DXP Cloudのバックエンドでは通常の環境変数よりもセキュリティが強化されています。 UIを介してシークレットを表示すると、表示される前に格納された値が復号化されます。

## 新しいシークレットを追加する

新しいシークレットは、DXP Cloudの *設定* 画面で追加されます。 *管理者*ロールを持つユーザーのみが新しいシークレットを追加できます。

```{warning}
サービスに新しいシークレットを追加すると、その値が有効になるようにサービスが再起動されます。
```

次の手順に従って、新しいシークレットを追加します。

1.  DXP Cloudコンソールにログインします。

2.  任意の環境の [*設定* ]画面に移動します。

    ![シークレットにアクセスするには、[設定]画面に移動します。](./managing-secure-environment-variables-with-secrets/images/02.png)

3.  ページの[ *シークレット* ]セクションで、[ *新しいシークレットの作成*]をクリックします。

    ![環境の設定画面から新しいシークレットを作成します。](./managing-secure-environment-variables-with-secrets/images/03.png)

4.  名前と説明を入力します。

    ![新しいシークレットの名前と説明を入力します。](./managing-secure-environment-variables-with-secrets/images/04.png)

5.  安全に保管するための秘密の値を入力します。 この値は、保存される前に暗号化されることを除いて、環境変数の値と同じように機能します。

    ![裏で暗号化するシークレットの値を入力します。](./managing-secure-environment-variables-with-secrets/images/05.png)

6.  該当する場合は、 *投稿者* または *ゲスト* 役割にシークレットの表示を許可するかどうかを選択します。 *Admin* 役割を持つユーザーは、いつでもシークレットを表示できます。

    ![管理者の役割に加えて、表示権限を与える役割を選択します。](./managing-secure-environment-variables-with-secrets/images/06.png)

7.  新しいシークレット環境変数を追加するサービスを選択します。 選択したサービスごとに、環境変数に使用するキーを入力します（複数のサービスで同じキーのシークレットを使用できます）。

    ![新しいシークレットを追加するサービスを選択します。](./managing-secure-environment-variables-with-secrets/images/07.png)

8.  前の手順でサービスを選択した場合は、下に表示されるボックスをオンにして、影響を受けるサービスにこのシークレットを追加することの影響を受け入れることを示します。 これらのボックスをオンにして、ボタンでシークレットを作成できるようにする必要があります。

    ![シークレットの作成を続行するには、表示されるボックスをオンにします。](./managing-secure-environment-variables-with-secrets/images/08.png)

9.  [シークレットを作成]をクリックします。

選択したサービスが再起動し、新しいシークレットが環境変数として適用されます。

## 既存のシークレットの表示と変更

既存のシークレットを表示または変更するには、任意の環境の *設定* ページに移動します。 次に、[ *シークレット* ]セクションで、リストされているシークレットの[アクション]メニューをクリックします。 シークレットを表示、編集、または削除するオプションが表示されます。

![[設定]ページから既存のシークレットを表示、編集、または削除します。](./managing-secure-environment-variables-with-secrets/images/09.png)

```{note}
ユーザーが秘密を閲覧する権限を持っていても、既存の秘密を編集したり削除したりできるのは `Admin` ロールを持つユーザーだけです。 Admin` ロールを持たないユーザが秘密のアクションメニューをクリックすると、秘密を表示するオプションのみが表示されます。
```

これは、表示権限を持つユーザーがシークレットの *表示* オプションをクリックしたときに表示されるページです。

![既存のシークレットのビューページ。](./managing-secure-environment-variables-with-secrets/images/10.png)

## 追加情報

  - [LCP.jsonを介した設定](../../reference/configuration-via-lcp-json.md)
  - [環境変数の定義](../../reference/defining-environment-variables.md)
