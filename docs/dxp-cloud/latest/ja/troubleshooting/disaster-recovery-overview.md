# ディザスタ リカバリの概要

Liferay DXP Cloudは、自動およびクロスリージョンという2つのディザスタ リカバリ戦略を提供します。

## 自動ディザスタ リカバリ戦略

DXP Cloudは、同じリージョン内の地理的に異なる場所にある3つのアベイラビリティーゾーン間でサービスを複製することにより、自動ディザスタ リカバリプロトコルを実行します。 アベイラビリティーゾーンのいずれかが利用できなくなった場合、ロードバランサーは、顧客側でDNSを変更する必要なく、残りのアベイラビリティーゾーンに自動的にルーティングします。 この状況では、 *インシデント中にお客様からのアクションは必要ありません*。

## 地域間のディザスタ リカバリ戦略

IT業界には、「コールド」、「ウォーム」、または「ホット」に分類されている複数のクロスリージョンDR戦略があります。 これらの戦略は、問題が発生したときにシステムがどのように回復する準備ができているかを示します。 一つの例えとしては、車を運転していてパンクした場合の対応です。 この状況への対処方法は、装備状況によって異なります。

| タイプ  | 解決策                                                                                                                             |
| ---- | ------------------------------------------------------------------------------------------------------------------------------- |
| コールド | あなたはスペアタイヤを持っていないので、新しいタイヤを持ってあなたに来るように誰かに電話しなければなりません。 あなたの旅行は誰かが来てタイヤを交換するまで止まります。                                            |
| ウォーム | スペアタイヤと交換キットを用意しているので、車に持っているものを使って道路に戻ることができます。 ただし、問題を修復するには停止する必要があります。                                                      |
| ホット  | あなたは特別なランフラットタイヤを持っています。 あなたは少し遅くする必要があるかもしれませんが、あなたの旅に直接の影響はありません。 あなたのタイヤはあなたが続けることができるほど十分によく走ります（あなたは最終的に問題に対処しなければなりませんが）。 |

DXP Cloudでは、DR戦略を *ウォーム*として分類します。 DXP Cloudユーザーは、障害シナリオに対応するためにサポートに連絡する必要はありませんが、クロスリージョン障害の場合に提供するツールを使用するために行動する必要があります。

## ディザスタリカバリのシナリオ例

ここでは、架空の障害シナリオの場合に、DXP Cloudディザスタ リカバリツールとアプローチがどのように機能するかの例を示します。

### インシデント発生時

| 時間       | イベント                                                                                                                               |
| -------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 午後12時30分 | 私たちの本番環境ではすべて正常です（ *europe-west2* リージョンにあります）。 ユーザーは問題なくシステムにアクセスできます。                                                             |
| 午後1時     | 1時間ごとの自動バックアップがトリガーされます。 これにより、データベースとドキュメントライブラリのコピーが生成されます。                                                                      |
| 午後2時     | 自動バックアップがもう一度トリガーされます。                                                                                                             |
| 午後2時34分  | *europe-west2* リージョン全体が侵害されたことが通知されます。 ダウンタイムを最小限に抑えるために、DR環境（ *us-west1* リージョンにある）を有効にするために移動します。 午後2時から午後2時34分まで、バックアップは生成されません。 |
| 午後2時39分  | 運用データベースとドキュメントライブラリの午後2時のバックアップをDR環境に復元します。                                                                                       |
| 午後2時41分  | 最新のビルド番号が本番環境から取得され、DR環境に展開されます。                                                                                                   |
| 午後2時45分  | チームは、VPNがDR環境で適切に設定されていることを検証します。                                                                                                  |
| 午後2時50分  | カスタムドメインは、ユーザートラフィックをDR環境にルーティングするように設定されています。                                                                                     |
| 午後3時     | すべてが正常に戻り、トラフィックはDR環境を介してルーティングされます。                                                                                               |

上記の手順にかかる時間は、アプリケーションのサイズとチームが応答できる速度によって異なります。

### インシデント後の回復

| 時間      | イベント                                                                        |
| ------- | --------------------------------------------------------------------------- |
| 午後４時    | チームに *europe-west2* リージョンが回復し、インシデントが終了したことが通知されます。 チームは、元の本番環境に移行する準備をします。 |
| 午後4時16分 | 障害発生時に新しいユーザーデータが生成されたため、DR環境の手動バックアップが実行されます。                              |
| 午後4時21分 | 手動バックアップが本番環境に復元され、カスタムドメイン設定が元の状態に戻ります。                                    |
| 午後4時25分 | トラフィックは元の本番環境に再ルーティングされます。                                                  |

## 追加情報

  - [クロスリージョンディザスタ リカバリの設定](./configuring-cross-region-disaster-recovery.md)
