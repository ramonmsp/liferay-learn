# デプロイメントの種類について

サービスの展開タイプによって、パフォーマンス、メモリ使用量、ファイルまたはボリュームへのアクセスなど、サービスの機能に関するさまざまな側面が決まります。 DXP Cloudは、そのサービスに2つの展開タイプを提供します： `Deployment` および `StatefulSet`。

## デプロイメントの違い

**Deployment** タイプには次の機能があります。

  - ネットワークファイルシステム（NFS）は、このサービスで利用可能なディレクトリにマウントされています
  - ネットワーク識別子（例えば、ランダムである `のLiferay-89f9f559`、 `のLiferay-d1267401`）
  - デプロイとスケーリングは順不同
  - 自動ローリング更新は順序付けされていません

一方、 **StatefulSet** タイプには次の機能があります。

  - サービスには専用SSDが割り当てられます
  - ネットワーク識別子が安定してユニークである（例えば、 `検索-0`、 `、検索-1`）
  - デプロイとスケーリングが注文されている
  - 自動ローリング更新が注文されます

以下は、 `Deployment` と `StatefulSet` タイプの間のいくつかの際立った特徴を要約しています。

| **タイプ**       | **目的**                 | **リソース使用量と起動時間**                         | **ローカルボリューム専用のSSD** | **NFSへのアクセス** | **オーダードスタートアップ/スケーリング** |
| ------------- | ---------------------- | ---------------------------------------- |:-------------------:|:-------------:|:-----------------------:|
| **デプロイ**      | NFSを使用したステートレスアプリケーション | 消費するリソースが少なく、 `StatefulSet` タイプより速く起動します |          X          |       ✓       |            X            |
| **ステートフルセット** | ステートフルアプリケーション         | より多くのリソースを消費し、 `よりも遅い起動` デプロイメントの種類      |          ✓          |       X       |            ✓            |

一般に、 `Deployment` タイプはより軽量であり、より高速なデプロイメント、およびサービス間での共有永続ボリューム（ドキュメントライブラリなどの共有ファイル用）を可能にします。 `StatefulSet` タイプは、デプロイメントとリソース使用量（プロジェクトに割り当てられたメモリとCPUの合計を含む）の方がコストがかかりますが、専用SSDを使用することにより、デプロイメントを通じてデータを保持し、ファイルアクセスパフォーマンスを向上させます。

### 永続的なボリューム（NFS）とSSDストレージの比較

Network File System（NFS）は、すべての `Deployment` タイプのサービスで利用できます。 NFSは、サービスが再デプロイされるか削除されるかに関わらず存続します。 ただし、NFSの外部に保存されているボリュームは、サービスが再デプロイされると失われます。

NFSに格納されているボリュームは、すべての `展開` タイプのサービスでも利用できます。 ドキュメントライブラリへのアクセスを共有するために、 `Liferay` および `Backup` サービスでは、NFSがそのまま使用されます。 NFS用のボリュームの設定の詳細は、 [永続的なファイルシステムボリュームの設定](./configuring-persistent-file-storage-volumes.md) を参照してください。

`StatefulSet` タイプのサービスには、代わりにすべてのボリュームストレージ専用のSSDがあります。 `StatefulSet` タイプのサービスで使用できる専用SSDは、他のサービスからアクセスできません。 SSDに保存されているボリュームは、再デプロイ後も保持されますが、サービスの削除後は保持されません。

## DXP Cloudのサービスの設定方法

以下は、DXP Cloudのサービスがすぐに事前設定されている方法の詳細です。

  - *Liferay* および *Backup* サービスは **Deployment** タイプを使用するため、NFSに保存されているドキュメントライブラリへのアクセスを共有できます。

  - *Database* および *Web Server* サービスも **Deployment** タイプを使用するため、軽量のままですばやく起動できます。

  - *CI* サービスは **StatefulSet** タイプを使用するため、専用SSDを使用することにより、ファイルアクセス速度が向上します。

  - *Search* サービスも **StatefulSet** タイプを使用するので、検索の速度が向上し、サービスが再起動してもSSDに保存されている検索インデックスが失われません。

## デプロイメントの種類の設定

デフォルトでは、DXP Cloudのサービスは、大部分のユースケースに適合するように事前設定されています。 ただし、各サービスのデプロイメントの種類は、サービスの `LCP.json`の `kind` 変数を介して設定できます。

``` json
{
    "id": "search",
    "kind": "StatefulSet"
}
```

**注：** DXP Cloudでのサービスのデプロイメントの種類は、データの損失やパフォーマンスに影響を与える可能性があるため、注意して変更する必要があります。

## 追加情報

  - [永続的なファイルシステムボリュームの設定](./configuring-persistent-file-storage-volumes.md)
  - [デプロイ戦略について](./understanding-deployment-strategies.md)
